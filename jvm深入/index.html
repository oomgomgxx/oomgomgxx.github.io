<!DOCTYPE html>
<html lang="zh-CN">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="DeeTam" />
  <meta name="description" content="学然后知不足" />
  
  
  <title>
    
      JVM入门 
      
      
    
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto:400,400italic,600|Roboto+Mono" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">


  

  
    
<link rel="stylesheet" href="/css/post.css">

  

  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


<meta name="generator" content="Hexo 6.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <a href="/">DEE TAM</a>
</div>


      <p class="links">
  
    <a title="归档" target="" href="/archives/">
      <i class="iconfont icon-bookmark"></i>
    </a>
  
    <a title="邮箱" target="" href="mailto:oomgomgxx@gmail.com">
      <i class="iconfont icon-envelope"></i>
    </a>
  
    <a title="QQ" target="" href="tencent://message/?Menu=yes&uin=0x1DACE601&Service=300&sigT=45a1e5847943b64c6ff3990f8a9e644d2b31356cb0b4ac6b24663a3c8dd0f8aa12a595b1714f9d45">
      <i class="iconfont icon-qq"></i>
    </a>
  
    <a title="关于" target="" href="/about/">
      <i class="iconfont icon-emoji-friendly"></i>
    </a>
  
</p>


      <div class="main">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>

<div class="post">
  
  <!--
  
    <h3 class="date">
    Feb 20, 2019
  </h3>
  
  -->

  
  <center>
    <h1>
      JVM入门
    </h1>
  </center>
  

  <div class="content markdown-body">
    <h2 id="内容修订"><a href="#内容修订" class="headerlink" title="内容修订"></a>内容修订</h2><ul>
<li>2019年10月23日22:53:01 — 删除即时编译器和GC相关内容</li>
</ul>
<h2 id="JDK包含什么"><a href="#JDK包含什么" class="headerlink" title="JDK包含什么"></a>JDK包含什么</h2><p><img src="/jvm%E6%B7%B1%E5%85%A5/1.png"></p>
<h2 id="类的基本结构"><a href="#类的基本结构" class="headerlink" title="类的基本结构"></a>类的基本结构</h2><p>类结构本身比较复杂，需要单开一篇文章，但如果只是为了了解类加载过程，那么简单了解一下就可以了</p>
<h3 id="一个简单的-Java-类"><a href="#一个简单的-Java-类" class="headerlink" title="一个简单的 Java 类"></a>一个简单的 Java 类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiJvm</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">num3</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHi</span><span class="params">()</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;hello jvm!!!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">Q:什么是字面量？ </span><br><span class="line">A:可以简单理解为直接以值的形式出现在代码中的标记</span><br><span class="line"></span><br><span class="line">Q:什么是符号引用？</span><br><span class="line">A:类和接口的全限定名称、字段名称和描述、方法名称和描述</span><br><span class="line">	</span><br><span class="line">Compiled from <span class="string">&quot;HiJvm.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiJvm</span></span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span> <span class="comment">// jdk1.8</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 常量池：可以简单为是一个用来存储类信息数据的容器</span></span><br><span class="line"><span class="comment">// 常量池会在类加载阶段转移到内存中，且在解析操作中符号引用会被解析为直接引用</span></span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">8.</span>#<span class="number">25</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">7.</span>#<span class="number">26</span>         <span class="comment">// HiJvm.num1:I</span></span><br><span class="line">   #<span class="number">3</span> = Fieldref           #<span class="number">27.</span>#<span class="number">28</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">4</span> = String             #<span class="number">29</span>            <span class="comment">// hello jvm!!!</span></span><br><span class="line">   #<span class="number">5</span> = Methodref          #<span class="number">30.</span>#<span class="number">31</span>        <span class="comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">   #<span class="number">6</span> = Fieldref           #<span class="number">7.</span>#<span class="number">32</span>         <span class="comment">// HiJvm.num2:I</span></span><br><span class="line">   #<span class="number">7</span> = Class              #<span class="number">33</span>            <span class="comment">// HiJvm</span></span><br><span class="line">   #<span class="number">8</span> = Class              #<span class="number">34</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">9</span> = Utf8               num1</span><br><span class="line">  #<span class="number">10</span> = Utf8               I</span><br><span class="line">  #<span class="number">11</span> = Utf8               num2</span><br><span class="line">  #<span class="number">12</span> = Utf8               num3</span><br><span class="line">  #<span class="number">13</span> = Utf8               ConstantValue</span><br><span class="line">  #<span class="number">14</span> = Integer            <span class="number">3</span></span><br><span class="line">  #<span class="number">15</span> = Utf8               &lt;init&gt;</span><br><span class="line">  #<span class="number">16</span> = Utf8               ()V</span><br><span class="line">  #<span class="number">17</span> = Utf8               Code</span><br><span class="line">  #<span class="number">18</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">19</span> = Utf8               getNum</span><br><span class="line">  #<span class="number">20</span> = Utf8               ()I</span><br><span class="line">  #<span class="number">21</span> = Utf8               sayHi</span><br><span class="line">  #<span class="number">22</span> = Utf8               &lt;clinit&gt;</span><br><span class="line">  #<span class="number">23</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">24</span> = Utf8               HiJvm.java</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 字段或方法的部分符号引用</span></span><br><span class="line">  #<span class="number">25</span> = NameAndType        #<span class="number">15</span>:#<span class="number">16</span>        <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">26</span> = NameAndType        #<span class="number">9</span>:#<span class="number">10</span>         <span class="comment">// num1:I</span></span><br><span class="line">  #<span class="number">27</span> = Class              #<span class="number">35</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">28</span> = NameAndType        #<span class="number">36</span>:#<span class="number">37</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">29</span> = Utf8               hello jvm!!!</span><br><span class="line">  #<span class="number">30</span> = Class              #<span class="number">38</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">31</span> = NameAndType        #<span class="number">39</span>:#<span class="number">40</span>        <span class="comment">// println:(Ljava/lang/String;)V</span></span><br><span class="line">  #<span class="number">32</span> = NameAndType        #<span class="number">11</span>:#<span class="number">10</span>        <span class="comment">// num2:I</span></span><br><span class="line">  #<span class="number">33</span> = Utf8               HiJvm</span><br><span class="line">  #<span class="number">34</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">35</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">36</span> = Utf8               out</span><br><span class="line">  #<span class="number">37</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">38</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">39</span> = Utf8               println</span><br><span class="line">  #<span class="number">40</span> = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> num2;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC <span class="comment">//访问符号，表示num2被public static修饰</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> num3;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL <span class="comment">//访问符号</span></span><br><span class="line">    ConstantValue: <span class="type">int</span> <span class="number">3</span>  <span class="comment">// 常量的值，所以为什么准备阶段可以直接赋值是因为ConstantValue就在class文件中</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 默认构造方法</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HiJvm</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span>   	</span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: aload_0</span><br><span class="line">         <span class="number">5</span>: iconst_1</span><br><span class="line">         <span class="number">6</span>: putfield      #<span class="number">2</span>                  <span class="comment">// Field num1:I</span></span><br><span class="line">         <span class="number">9</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">1</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">2</span>: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">100</span></span><br><span class="line">         <span class="number">2</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHi</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">		 <span class="number">3</span>: ldc           #<span class="number">4</span>                  <span class="comment">// String hello jvm!!!</span></span><br><span class="line">         <span class="number">5</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">		 <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">11</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">8</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 当类中存在静态成员时，编译器会自动生成一个statis&#123;&#125;,用于初始化阶段初始化静态变量（类变量）</span></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: iconst_2</span><br><span class="line">         <span class="number">1</span>: putstatic     #<span class="number">6</span>                  <span class="comment">// Field num2:I</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关于代码块和构造方法"><a href="#关于代码块和构造方法" class="headerlink" title="关于代码块和构造方法"></a>关于代码块和构造方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiJvm</span> &#123;</span><br><span class="line">	<span class="comment">// 代码块</span></span><br><span class="line">	&#123; System.out.println(<span class="string">&quot;code area1&quot;</span>);&#125;</span><br><span class="line">	<span class="comment">// 构造器</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">HiJvm</span><span class="params">()</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;construct method&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	&#123; System.out.println(<span class="string">&quot;code area2&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HiJvm</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">7</span>: ldc           #<span class="number">3</span>                  <span class="comment">// String code area1</span></span><br><span class="line">         <span class="number">9</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        <span class="number">12</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;		</span></span><br><span class="line">        <span class="number">15</span>: ldc           #<span class="number">5</span>                  <span class="comment">// String code area2</span></span><br><span class="line">        <span class="number">17</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        <span class="number">20</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">23</span>: ldc           #<span class="number">6</span>                  <span class="comment">// String construct method</span></span><br><span class="line">        <span class="number">25</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        <span class="number">28</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">4</span>: <span class="number">4</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">12</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">20</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">28</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出代码块优先于构造器的初始化，且按照定义的顺序执行</p>
<h3 id="静态块"><a href="#静态块" class="headerlink" title="静态块"></a>静态块</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiJvm</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">aaa</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;static code area1&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">bbb</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">HiJvm</span><span class="params">()</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;construct method&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;static code area2&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> aaa;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> bbb;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HiJvm</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">7</span>: ldc           #<span class="number">3</span>                  <span class="comment">// String construct method</span></span><br><span class="line">         <span class="number">9</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        <span class="number">12</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">11</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">4</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">12</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 静态代码块：静态代码块在初始化阶段运行，比构造方法先打印</span></span><br><span class="line">	<span class="comment">// 结论：</span></span><br><span class="line">	<span class="comment">//	1.静态成员是按照定义顺序执行的</span></span><br><span class="line">	<span class="comment">//	2.不论有多少个static&#123;&#125;都会按顺序编译成1个，然后按顺序将其它静态成员包含进来</span></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: iconst_1</span><br><span class="line">         <span class="number">1</span>: putstatic     #<span class="number">5</span>                  <span class="comment">// Field aaa:I</span></span><br><span class="line">         <span class="number">4</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">7</span>: ldc           #<span class="number">6</span>                  <span class="comment">// String static code area1</span></span><br><span class="line">         <span class="number">9</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        <span class="number">12</span>: iconst_2</span><br><span class="line">        <span class="number">13</span>: putstatic     #<span class="number">7</span>                  <span class="comment">// Field bbb:I</span></span><br><span class="line">        <span class="number">16</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">19</span>: ldc           #<span class="number">8</span>                  <span class="comment">// String static code area2</span></span><br><span class="line">        <span class="number">21</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        <span class="number">24</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">6</span>: <span class="number">4</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">12</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">16</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">24</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结论：</p>
<p>1）类定义的执行优先顺序</p>
<p>常量(final) &gt; 静态成员（静态变量和静态代码块，顺序执行） &gt; 普通成员(变量和代码块，顺序执行) &gt; 构造方法（普通成员就是在构造方法中初始化的）</p>
<p>2）初始化时机</p>
<ul>
<li>常量(final)：类加载的【准备阶段】</li>
<li>静态成员：类加载的【初始化阶段】</li>
<li>普通成员、构造方法：实例化时（new）</li>
</ul>
<h2 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a>类加载过程</h2><p><img src="/jvm%E6%B7%B1%E5%85%A5/2.png"></p>
<p>加载</p>
<ul>
<li>通过类加载器将 Class 转为二进制字节流，并将其中的静态存储结构（常量池）转化成运行时常量池，最后在堆中生成一个对应的 Class 实例，该实例用将作为作为方法区的入口</li>
</ul>
<p>连接</p>
<ol>
<li><p>验证：对字节码流进行校验（魔数、版本号、符号引用等等）</p>
</li>
<li><p>准备：给类成员分配内存并初始化</p>
<ol>
<li><p>普通成员（static）</p>
<img src="jvm深入/3.png" style="zoom:67%;" />
</li>
<li><p>常量（static final）：因为常量在编译时就已经可以确认值所以在准备阶段，就可以直接赋予源码中定义的值</p>
</li>
</ol>
</li>
<li><p>解析：将静态存储结构中的符号引用解析为直接引用</p>
</li>
</ol>
<p>初始化</p>
<ul>
<li><p>初始化阶段是整个类加载过程的最后一个阶段</p>
</li>
<li><p>主要是对实例变量和类成员进行赋值</p>
</li>
<li><p>以下几种情况会导致类初始化</p>
<ul>
<li>类实例化</li>
<li>子类实例化</li>
<li>类静态成员被调用（包含子类.父类静态成员）</li>
<li>通过 Class.forName() 方法加载类</li>
</ul>
</li>
<li><p>以下几种情况不会导致类初始化</p>
<ul>
<li>当子类引用父类的静态成员时，只初始化父类，而不会初始化当前子类</li>
<li>访问常量</li>
<li>通过类名获取Class对象，不会触发类的初始化（A.class）</li>
<li>通过 ClassLoader 默认的 loadClass 方法加载类，也不会触发类初始化</li>
</ul>
</li>
</ul>
<h2 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h2><p>在《深入理解Java虚拟机》中有句这样的话，”比较两个类是否’相等‘，只有在这两个类是有同一个类加载器加载的前提下才有意义”。也就是说即使是同一个class文件，但是由不同的类加载器加载，产生出来的实例都是属于不同派系的。</p>
<p><img src="/jvm%E6%B7%B1%E5%85%A5/4.png"></p>
<ul>
<li><p>启动类加载器：用于加载 JVM 的依赖</p>
</li>
<li><p>扩展类加载器：用于加载 JAVA_HOME\lib\ext 目录下的依赖</p>
</li>
<li><p>应用程序类加载器：用于 classpath 下的依赖</p>
</li>
</ul>
<p>首先，双亲委派模型并不是一定要遵守的，而之所以建议遵守主要目的是为了防止同一个 Class 文件被不同的类加载器多次加载而导致生成多个 Class 实例。因为如果像 Object 这种顶级被加载多次，就会导致程序混乱而崩溃，这并不是一般人乐意见到的。</p>
<h2 id="Java-Virtual-Machine"><a href="#Java-Virtual-Machine" class="headerlink" title="Java Virtual Machine"></a>Java Virtual Machine</h2><ul>
<li>它是 Java 一次编译到处运行的基础</li>
<li>Java 通过编译器将源码编译成 JVM 识别的字节码（这是一种中间码，介乎于机器码和高级语言之间）来运行 Java 程序，而不是像 C&#x2F;C++ 那样直接编译成机器码运行</li>
<li>目前除了 Java 之外，还有 Kotlin、Groovy、Scala 等都基于 JVM 的，所以不要认为 JVM 只能运行 Java 程序。准确点说 JVM 识别的是字节码而不是具体语言，只不过 JVM 是从 Java 中诞生而已</li>
</ul>
<h2 id="运行时数据区"><a href="#运行时数据区" class="headerlink" title="运行时数据区"></a>运行时数据区</h2><p><img src="/jvm%E6%B7%B1%E5%85%A5/5.png"></p>
<p>1）线程共享区域</p>
<ol>
<li><p>方法区</p>
<ul>
<li>方法区会在虚拟机启动时创建</li>
<li>用于存放已加载的：类信息（类成员、方法信息）、JIT 编译产生的机器码</li>
</ul>
</li>
<li><p>运行时常量池</p>
<ul>
<li>Class 被加载时会将字节码中的常量池信息转化为运行时常量池保存到内存中以提供给后续实例使用</li>
</ul>
</li>
<li><p>堆内存</p>
<ul>
<li>用于给对象分配内存</li>
</ul>
</li>
</ol>
<p>2）线程独占区域</p>
<ol>
<li><p>程序计数器</p>
<ul>
<li>记录程序下一条将要执行的指令位置</li>
</ul>
</li>
<li><p>虚拟机栈</p>
<ul>
<li><p>用于执行方法和存储变量、</p>
</li>
<li><p>栈内存属于对堆内存，虽然受到 JVM 参数限制，但这部分空间时由系统来分配和回收的</p>
</li>
<li><p>栈内存由一个个栈帧组成，而没调用一个方法就会生成一个栈帧。栈帧结构如下</p>
<ul>
<li><p>局部变量表</p>
</li>
<li><p>动态连接</p>
</li>
<li><p>常量池指针</p>
</li>
<li><p>方法出口</p>
</li>
<li><p>操作数栈（因为Java没有寄存器，所以参数传递使用操作数栈来完成）</p>
<p><img src="/jvm%E6%B7%B1%E5%85%A5/012.png"></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>本地方法栈</p>
<ul>
<li>本地方法栈和虚拟机栈功能是一样的，区别只在于本地方法栈针对的是 native 方法</li>
<li>native 方法是本地方法，由 C++ 实现</li>
<li>在当前Hotspot虚拟机中，虚拟机栈和本地方法栈是没有区分的</li>
</ul>
</li>
</ol>
<h2 id="JVM是如何给对象分配内存的"><a href="#JVM是如何给对象分配内存的" class="headerlink" title="JVM是如何给对象分配内存的"></a>JVM是如何给对象分配内存的</h2><h3 id="何时得知对象的大小？"><a href="#何时得知对象的大小？" class="headerlink" title="何时得知对象的大小？"></a>何时得知对象的大小？</h3><ul>
<li>对象所需的内存大小在类加载过程完成后就可以得知（对象头+内定义）。</li>
</ul>
<h3 id="内存分配的两种方案"><a href="#内存分配的两种方案" class="headerlink" title="内存分配的两种方案"></a>内存分配的两种方案</h3><p>指针碰撞</p>
<ul>
<li>使用<strong>分界点指示器</strong>记录指针位置，通过挪动指针来分配内存</li>
<li>这种分配方式分配出来的空间是规整的</li>
</ul>
<p>空闲列表</p>
<ul>
<li>通过维护一个<strong>空闲列表</strong>来分配内存。这个空闲列表记录了哪些内存是可用的，在分配空间时，在这个列表中选出一块足够大的空间来分配给对象</li>
<li>这种分配方式分配的内存时不规整的</li>
</ul>
<p>使用哪种内存分配方式取决于 GC 用的回收算法。例如标记-复制、标记-整理用的是指针碰撞，而标记-清除则用的是空闲列表。</p>
<h3 id="堆内存分配时如何保证线程安全？"><a href="#堆内存分配时如何保证线程安全？" class="headerlink" title="堆内存分配时如何保证线程安全？"></a>堆内存分配时如何保证线程安全？</h3><p>因为堆时线程共享的所以如果不做任何处理的话它并不是线程安全的。</p>
<p>在 JVM 中使用一种叫 TLAB（线程本地分配缓存）的机制来解决线程并发申请内存的问题。开启 TLAB 后，虚拟机会为每条线程在堆中预先分配一小块内存，那么当线程需要申请内存创建对象时，就可以在预先分配好的区域内创建了，而等到内存不足时才会再向虚拟机申请。</p>
<h3 id="内存逃逸分析"><a href="#内存逃逸分析" class="headerlink" title="内存逃逸分析"></a>内存逃逸分析</h3><p>内存逃逸分析是 JIT 编译时的优化手段，即判断在方法中创建的对象实例有没有被外部引用的可能。如果没有则直接在栈内存中分配。上面已经提到，栈内存属于对外内存，由系统管理，分配和回收的效率都非常高，所以这样做的好处是可以降低 GC 负担以及堆内存占用量。</p>
<h2 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h2><h3 id="什么是垃圾？"><a href="#什么是垃圾？" class="headerlink" title="什么是垃圾？"></a>什么是垃圾？</h3><p>在 Java 中内存是有 GC 自动管理的。而当一个对象没有任何引用时，就会被视为“垃圾”，即表示它所占用的内存可以被 GC 回收。</p>
<h3 id="如何确认对象没有引用？"><a href="#如何确认对象没有引用？" class="headerlink" title="如何确认对象没有引用？"></a>如何确认对象没有引用？</h3><p>1）引用计数器算法</p>
<ul>
<li>使用计数器来记录对象实例是否有引用，即当计数器为 0 时就表示该对象所占用的内存可以被回收了</li>
<li>优点是实现起来简单，但存在无用对象循环引用的情况，所以回收效率一般</li>
</ul>
<p>2）可达性分析算法（根搜索算法）</p>
<ul>
<li><p>先选出对象代表集合（GC Root），然后再从集合成员中延伸引用，如果延伸不到，则可视为”垃圾“</p>
<p><img src="/jvm%E6%B7%B1%E5%85%A5/9.png"></p>
</li>
<li><p>可以作为 GC Root 的对象实例（可通过MAT工具查看）：</p>
<ul>
<li>全局实例<ul>
<li>常量实例</li>
<li>类静态成员实例</li>
<li>ClassLoader</li>
</ul>
</li>
<li>JNI实例</li>
<li>线程实例</li>
<li>栈帧中局部变量表中应用的实例</li>
<li>锁对象实例</li>
</ul>
</li>
</ul>
<p>目前 Hotspot 中默认用的是可达性分析算法。</p>
<h3 id="对象的4种引用"><a href="#对象的4种引用" class="headerlink" title="对象的4种引用"></a>对象的4种引用</h3><p>强引用</p>
<ul>
<li>基本上都是强引用，因为其他3中需要实现特定抽象类</li>
<li>特点是 GC 即使抛出 OOM 都不会回收其内存</li>
</ul>
<p>软引用</p>
<ul>
<li>需要继承了 SoftReference 抽象类</li>
<li>当这类实例丢失强引用后，会在 GC 发现内存不足时被回收（即第一次GC后发现依然不够足够的空间分配就会回收软引用）</li>
<li>作用：可以用来做缓存</li>
</ul>
<p>弱引用</p>
<ul>
<li>需要继承了 WaekReference 抽象类</li>
<li>当这类实例丢失强引用后，会被 GC 回收</li>
<li>作用：临时实例</li>
</ul>
<p>虚引用</p>
<ol>
<li>需要继承了 PhantomReference 抽象类</li>
<li>虚引用不对实例产生任何副作用，即如果丢失强引用则随时被回收</li>
<li>作用：监听实例被回收</li>
</ol>
<h3 id="对象的自我拯救"><a href="#对象的自我拯救" class="headerlink" title="对象的自我拯救"></a>对象的自我拯救</h3><p>当一个象被 GC 认为不可达过时 GC 会对其进行第 1 次标记，然后会根据这个对象<strong>是否有实现 finalize 方法</strong>或 <strong>是否已经调用过 finalize 方法</strong>作为条件判断。</p>
<ul>
<li>情况1：没有实现 finalize，等待回收</li>
<li>情况2：有实现 finalize 但已经调用且没有”自救（从finalize中重新复制给外面的变量）”，等待回收</li>
<li>情况3：有实现 finalize 且没有被调用过，则将其包装为 FinalReference 实例并添加到 F-Queue 队列中，然后让一条名为 Finalizer 的线程回调其 finalize，等待下一次标记</li>
</ul>
<p>注意：由于 Finalizer 是一条单一的线程，而虚拟机为了避免其阻塞，所以一旦遇到一个执行时间较长的 finalize 就可能会被丢弃。因此不建议将 finalize 视为析构函数来对待。</p>
<h3 id="垃圾回收算法-1"><a href="#垃圾回收算法-1" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h3><blockquote>
<p>标记-清除</p>
</blockquote>
<p><img src="/jvm%E6%B7%B1%E5%85%A5/6.png"></p>
<ul>
<li>先对存活对象进行标记，然后清理其余内存</li>
<li>特点是高效，但存在内存碎片化问题</li>
<li>该算法由 CMS 垃圾回收器实现</li>
</ul>
<blockquote>
<p>标记-复制</p>
</blockquote>
<p><img src="/jvm%E6%B7%B1%E5%85%A5/7.png"></p>
<ul>
<li>先将内存一分为二（可以更多），然后只使用其中的一半来存储对象实例</li>
<li>在回收时会先标记存活对象，然后将其复制到另一边，最后再清理之前的那一边</li>
<li>特点是高效，且有整理内存操作，所以在后续使用时内存会相对规整，但内存使用率不高</li>
<li>该算法常用在新生代区域回收</li>
</ul>
<blockquote>
<p>标记-整理</p>
</blockquote>
<p><img src="/jvm%E6%B7%B1%E5%85%A5/8.png"></p>
<ul>
<li>先对存活对象实例进行标记，然后清理其余内存，最后将存活的对象实例整理到一边</li>
<li>特点是空间利用率高，且没有内存碎片化问题，但相对效率较低</li>
<li>该算法常用在老年代区域回收</li>
</ul>
<h2 id="分代回收"><a href="#分代回收" class="headerlink" title="分代回收"></a>分代回收</h2><p><img src="/jvm%E6%B7%B1%E5%85%A5/10.png"></p>
<ul>
<li><p>目前 JVM 中的 GC 基本上都是基于分代回收策略的基础上实现的。</p>
</li>
<li><p>即将堆内存分为<strong>新生代</strong>和<strong>老年代</strong>。而新生代又分为 Eden 和 两个 Survivor 区域</p>
</li>
<li><p>新生代和老年代的内存占有比例是 1：2，而 Eden 和 Survivor 则是 8:1:1</p>
</li>
<li><p>其中两个 Survivor 区域又叫 from 和 to，或 s0 和 s1</p>
</li>
</ul>
<h3 id="新生代"><a href="#新生代" class="headerlink" title="新生代"></a>新生代</h3><ul>
<li><p>几乎所有对象都 Eden 分配内存，除了大对象以及逃逸分析之外</p>
</li>
<li><p>经过专门人员调查研究发现，其实大部分对象实例都是“朝生暮死”的，所以新生代采用的是<strong>复制算法</strong>，这也是为什么将新生代分为 Eden 区和 Survivor 区的原因</p>
</li>
<li><p>个人理解之所以有两块 Survivor 区的主要因为是为了提高 Eden 区的使用率，既即使是在 Survivor 中存活下来了也不用拷贝回 Eden 区，而且本身很多对象是“朝生暮死”的，所以能经历多次 GC 的并不多，所以用两块较小的内存来负责拷贝工作从设计来说显然更加合理</p>
</li>
<li><p>每个对象实例都有对应的对象头，其中就保留了一个年龄计数器（默认15，可通过 +XX:MaxTenuringThreshold 设置）。即每经历一次 GC 如果没被回收该值就会加一，直到满足 MaxTenuringThreshold 值就会晋升到老年代。除此之外，如果 Survivor  区已经达到了指定的使用率（-XX:TargetSurvivorRatio），则 GC 会重新计算当前存活实例的晋升年龄（不会超过MaxTenuringThreshold），然后再将超过该年龄的存活对象实例晋升到老年代。最后，还有一种特别情况，就是当对象实例比较大时（-XX:PretenureSizeThreshold）会直接在老年代分配</p>
</li>
</ul>
<h3 id="老年代"><a href="#老年代" class="headerlink" title="老年代"></a>老年代</h3><ul>
<li>用于存放大岁数以及占用内存较大的对象实例</li>
<li>因为在老年代中的对象都是些长寿对象，所以 GC 并不频繁，因此大多数 GC 会同过实现标记-整理算法来管理这块内存</li>
</ul>
<h2 id="Young-GC-和-Full-GC"><a href="#Young-GC-和-Full-GC" class="headerlink" title="Young GC 和 Full GC"></a>Young GC 和 Full GC</h2><ul>
<li>Young GC 是对 GC 回收新生代的称呼，而 Full GC 则对 GC 回收一整块堆内存以及方法区的称呼</li>
<li>Young GC 执行时机<ol>
<li>当 Eden 区没有充足的空间前，会判断老年代是否有足够大的空间来容纳当前新生代中的所有存活实例</li>
<li>如果有则执行 Young GC，否则继续判断老年代是否有能容量历届平均值的对象空间</li>
<li>如果有则执行 Young GC，否则执行 Full GC</li>
</ol>
</li>
<li>Full GC 执行时机<ul>
<li>当老年代、方法区无法分配内存时会</li>
<li>显示调用 System.gc() 或 Runtime.gc()</li>
</ul>
</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>
  </div>
  
    
      <a id="older" class="blog-nav" href="/%E5%85%B3%E4%BA%8Espring%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8/">OLDER&nbsp;&gt;</a>
      
        
          <a id="newer" class="blog-nav" href="/%E5%85%AC%E5%85%B1%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E4%B9%8BPrometheus%E7%9B%91%E6%8E%A7%E5%85%A5%E9%97%A8/">&lt;&nbsp;NEWER</a>
          
            
</div>
        <div class="footer">
  
    <div class="footer-more">
      
        <a href="/"><em style="color:red;">新站点正在开发中，网站暂停更新。</em></a>
        
    </div>
  
    <div class="footer-more">
      
        <a href="/">Copyright © DeeTam 2022</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-box">
        <div class="search-title">
          <!-- <span class="search-icon-input">
            <a href="javascript: void(0)">
              <i class="iconfont icon-search"></i>
            </a>
          </span> -->
          
            <input type="text" class="search-input" id="search-input" placeholder="搜索...">
          
          <span class="search-close-icon" id="search-close-icon">
            <a href="javascript: void(0)">
              <i class="iconfont icon-close"></i>
            </a>
          </span>
        </div>
        <div class="search-result" id="search-result"></div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    // inputArea.onclick = function() {
    //   getSearchFile()
    //   this.onclick = null
    // }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        inputArea.focus()
        getSearchFile()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'><span></ul>";
      // $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='/" + data_url + "' class='search-result-title'><h2>" + orig_data_title + "</h2></a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<h3 class=\"search-result-abstract\">" + match_content + "...</h3>"
                }
                str += "<hr></li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/leedom92/hexo-theme-leedom#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div>
  </body>
</html>
